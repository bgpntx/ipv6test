# Keep ipv6.0ms.app as the existing static tester site
ipv6.0ms.app {
    encode zstd gzip
    log {
        output stdout
        format console
    }

    root * /srv
    file_server
    templates
}

# 0ms.app serves the Go IP API
0ms.app {
    encode zstd gzip
    log {
        output stdout
        format console
    }

    @browser header_regexp browser User-Agent .*Mozilla.*
    redir @browser https://ipv6.0ms.app

    reverse_proxy 127.0.0.1:8080 {
        header_up X-Real-IP {remote}
        header_up CF-Connecting-IP {remote}
    }
}

# Subdomains used by the tester for active checks
ipv6.ipv6.0ms.app {
    encode zstd gzip
    log {
        output stdout
        format console
    }

    @ping path /ping.png
    root @ping /srv
    header @ping Cache-Control "public, max-age=60"
    file_server @ping

    # optional: deny directory listing
    respond / 204
}

ipv4.ipv6.0ms.app {
    encode zstd gzip
    log {
        output stdout
        format console
    }

    @ping path /ping.png
    root @ping /srv
    header @ping Cache-Control "public, max-age=60"
    file_server @ping

    respond / 204
}
